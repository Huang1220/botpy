# 事件监听

**本文档概述[botpy的事件监听](https://github.com/tencent-connect/botpy/blob/feature/botpy_1.0/botpy/flags.py)**

## 目录
- [准备](#准备)
- [使用方式](#使用方式)
- [监听的事件](#监听的事件)
  + [公域消息事件的监听](#公域消息事件的监听)
  + [消息事件的监听](#消息事件的监听)


## 准备
```python
import botpy
```

## 使用方式

通过继承实现`bot.Client`, 实现自己的机器人Client

在`MyClient`类中调用函数实现处理事件的功能

```python
class MyClient(botpy.Client):
```

## 监听的事件

### 公域消息事件的监听

首先需要订阅事件`public_guild_messages`

```python
intents = botpy.Intents(public_guild_messages=True) 
client = MyClient(intents=intents)
```

|对应函数| 说明 |
| --------- | ---- |
| on_at_message_create(self, message: Message) | 当收到@机器人的消息时 |
| on_public_message_delete(self, message: Message) | 当频道的消息被删除时 |

- **注：需要引入`Message`**
```python
from botpy.message import Message
```

```python
class MyClient(botpy.Client):
    async def on_at_message_create(self, message: Message):
        """
        此处为处理该事件的代码
        """
    async def on_public_message_delete(self, message: Message):
        """
        此处为处理该事件的代码
        """
```

### 消息事件的监听


- **仅 私域 机器人能够设置此 intents**


首先需要订阅事件`guild_messages`

```python
intents = botpy.Intents(guild_messages=True) 
client = MyClient(intents=intents)
```

|对应函数| 说明 |
| --------- | ---- |
| on_message_create(self, message: Message) | 发送消息事件，代表频道内的全部消息，而不只是 at 机器人的消息。</br>内容与 AT_MESSAGE_CREATE 相同 |
| on_message_delete(self, message: Message) | 删除（撤回）消息事件 |

- **注：需要引入`Message`**
```python
from botpy.message import Message
```

```python
class MyClient(botpy.Client):
    async def on_message_create(self, message: Message):
        """
        此处为处理该事件的代码
        """
    async def on_message_delete(self, message: Message):
        """
        此处为处理该事件的代码
        """
```

### 私信事件的监听

首先需要订阅事件`direct_message`

```python
intents = botpy.Intents(direct_message=True) 
client = MyClient(intents=intents)
```

|对应函数| 说明 |
| --------- | ---- |
| on_direct_message_create(self, message: Message) | 当收到用户发给机器人的私信消息时 |
| on_direct_message_delete(self, message: Message) | 删除（撤回）消息事件 |

- **注：需要引入`Message`**
```python
from botpy.message import Message
```

```python
class MyClient(botpy.Client):
    async def on_direct_message_create(self, message: Message):
        """
        此处为处理该事件的代码
        """
    async def on_direct_message_delete(self, message: Message):
        """
        此处为处理该事件的代码
        """
```

### 消息相关互动事件的监听

首先需要订阅事件`guild_message_reactions`

```python
intents = botpy.Intents(guild_message_reactions=True) 
client = MyClient(intents=intents)
```

|对应函数| 说明 |
| --------- | ---- |
| on_message_reaction_add(self, reaction: Reaction) | 为消息添加表情表态 |
| on_message_reaction_remove(self, reaction: Reaction) | 为消息删除表情表态 |

- **注：需要引入`Reaction`**
```python
from botpy.types.reaction import Reaction
```

```python
class MyClient(botpy.Client):
    async def on_message_reaction_add(self, reaction: Reaction):
        """
        此处为处理该事件的代码
        """
    async def on_message_reaction_remove(self, reaction: Reaction):
        """
        此处为处理该事件的代码
        """
```

### 频道事件的监听

首先需要订阅事件`guilds`

```python
intents = botpy.Intents(guilds=True) 
client = MyClient(intents=intents)
```

|对应函数| 说明 |
| --------- | ---- |
| on_guild_create(self, guild: Guild) | 当机器人加入新guild时 |
| on_guild_update(self, guild: Guild) | 当guild资料发生变更时 |
| on_guild_delete(self, guild: Guild) | 当机器人退出guild时 |
| on_channel_create(self, channel: Channel) | 当channel被创建时 |
| on_channel_update(self, channel: Channel) | 当channel被更新时 |
| on_channel_delete(self, channel: Channel) | 当channel被删除时 |


- **注：需要引入`Guild`和`Channel`**
```python
from botpy.guild import Guild
from botpy.channel import Channel
```

```python
class MyClient(botpy.Client):
    async def on_guild_create(self, guild: Guild):
        """
        此处为处理该事件的代码
        """
    async def on_guild_update(self, guild: Guild):
        """
        此处为处理该事件的代码
        """
    async def on_guild_delete(self, guild: Guild):
        """
        此处为处理该事件的代码
        """
    async def on_channel_create(self, channel: Channel):
        """
        此处为处理该事件的代码
        """
    async def on_channel_update(self, channel: Channel):
        """
        此处为处理该事件的代码
        """
    async def on_channel_delete(self, channel: Channel):
        """
        此处为处理该事件的代码
        """
```
